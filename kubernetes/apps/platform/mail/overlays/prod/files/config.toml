# Stalwart Configuration Override
# This file supplements the default configuration

[server]

[authentication.fallback-admin]
user = "admin_fallback"
secret = "%{file:/opt/stalwart/secrets/ADMIN_PASSWORD}%"

[tracer."stdout"]
type = "stdout"
level = "info"

[server.listener."smtp"]
bind = ["0.0.0.0:25"]
protocol = "smtp"

[server.listener."submission"]
bind = ["0.0.0.0:587"]
protocol = "smtp"
tls.implicit = false

[server.listener."smtps"]
bind = ["0.0.0.0:465"]
protocol = "smtp"
tls.implicit = true

[server.listener."imap"]
bind = ["0.0.0.0:143"]
protocol = "imap"
tls.implicit = false

[server.listener."imaps"]
bind = ["0.0.0.0:993"]
protocol = "imap"
tls.implicit = true

[server.listener."pop3"]
bind = ["0.0.0.0:110"]
protocol = "pop3"
tls.implicit = false

[server.listener."pop3s"]
bind = ["0.0.0.0:995"]
protocol = "pop3"
tls.implicit = true

[server.listener."sieve"]
bind = ["0.0.0.0:4190"]
protocol = "managesieve"

[server.listener."http"]
bind = ["0.0.0.0:8080"]
protocol = "http"

[server.listener."https"]
bind = ["0.0.0.0:443"]
protocol = "http"
tls.implicit = true

[storage]
data = "postgresql"
lookup = "postgresql"
fts = "postgresql"
blob = "s3"
directory = "internal"

[directory."internal"]
type = "internal"
store = "postgresql"

[store."postgresql"]
type = "postgresql"
host = "stalwart-postgresql-rw.stalwart.svc.cluster.local"
port = 5432
database = "stalwart"
user = "%{file:/opt/stalwart/db-secrets/username}%"
password = "%{file:/opt/stalwart/db-secrets/password}%"

[store."s3"]
compression = "lz4"

[store."nats"]
type = "nats"
address = ["nats://stalwart-nats.stalwart.svc.cluster.local:4222"]
no-echo = true
tls.enable = false
ping-interval = "60s"
max-reconnects = 0

[store."nats".timeout]
connection = "5s"
request = "10s"

[store."nats".capacity]
client = 2048
subscription = 65536
read-buffer = 65535

[cluster]
coordinator = "nats"
node-id = "%{env:STALWART_NODE_ID}%"
